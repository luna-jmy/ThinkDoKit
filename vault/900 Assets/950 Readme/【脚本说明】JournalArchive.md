---
created: 2026-01-19
area: Obsidian
type: readme
status: active
priority: 4
tags:
source:
keywords:
obsidianUIMode: preview
---

脚本文件：[[JournalArchive.js]]

## 使用说明

### 功能简介
此脚本用于在**周日志**或**月日志**中，自动归档该时间范围内所有 daily 日志的内容。归档内容会经过过滤和格式化，方便回顾和整理。

### 特点
- **自动识别日期范围**：根据周/月日志的元数据自动计算归档范围，无需手动选择
- **智能内容过滤**：自动移除 frontmatter、代码块、按钮、空值字段等无关内容
- **标题层级调整**：自动增加标题层级，使归档内容结构更清晰
- **灵活的输出方式**：支持插入到光标位置、追加到文件末尾、或复制到剪贴板

### 注意事项
- 此脚本仅支持 **Weekly**（周）和 **Monthly**（月）日志
- 当前笔记必须包含 `journal-date` 和 `journal` 元数据字段
- 归档范围为：周日志（7天）或 月日志（整月）

### 使用方法

1. 在周日志或月日志笔记中运行 QuickAdd 宏
2. 脚本会自动识别日志类型和日期范围
3. 选择输出方式：
   - **📍 光标位置插入**：在当前光标位置插入归档内容
   - **📄 文件末尾追加**：在文件末尾添加归档内容
   - **📋 复制到剪贴板**：将归档内容复制到剪贴板，不修改文件

### 日期范围规则

#### 周日志
- 从 `journal-date` 开始，归档 7 天的日志
- 标题显示为：`## 🗄️ 2026年01月12日周报告档`

#### 月日志
- 归档 `journal-date` 所在的整个月份
- 标题显示为：`## 🗄️ 2026年01月月报告档`

### 内容过滤规则

脚本会自动过滤以下内容：
- ✅ 移除 frontmatter（`---` 包围的元数据）
- ✅ 移除大标题（如 `# 2026-01-12 日志`）
- ✅ 移除备注内容（`%%备注%%`）
- ✅ 移除代码块
- ✅ 移除 callout 引用块
- ✅ 移除按钮（`button-*`）
- ✅ 移除推迟的重复任务
- ✅ 移除空值的内联字段行
- ✅ 排除"收件箱清理"部分
- ✅ 标题层级自动增加（`###` → `####`）

### 特殊功能

#### 自动提取"明天想改进的事"
脚本会自动从**前一天日志**中提取"明天想改进的事"字段，并替换到当前归档中对应的 DataviewJS 表达式。

支持多种提取方式：
1. Frontmatter 元数据
2. 内联字段格式
3. 标题下的内容
4. DataviewJS 表达式

### 输出示例

```markdown
## 🗄️ 2026年01月12日周报告档

### 周一 2026-01-12

#### ✨ 今日关注
...

#### 👀 GTD任务看板
...

#### ✍️ 今日小结与回顾
...

---

### 周二 2026-01-13

#### ✨ 今日关注
...

---

> 已归档 5/7 天日志 | 归档范围: 2026年01月12日周报
```

### 使用场景

- 📊 **周度回顾**：快速查看一周的重要事项和总结
- 📈 **月度归档**：将一月的日志整理成归档，方便后续回顾
- 📝 **内容整理**：过滤无关信息，保留核心内容
- 💾 **长期保存**：将日常日志归档到周/月日志中，便于管理

### 技术说明

#### 依赖项
- **QuickAdd 插件**：用于运行脚本
- **Obsidian API**：用于读取文件和元数据

#### 元数据要求
周/月日志笔记需要包含以下 frontmatter：

```yaml
---
journal: Weekly  # 或 Monthly
journal-date: 2026-01-12
---
```

#### 归档路径
脚本默认从以下路径读取 daily 日志：
```
500 Journal/540 Daily/YYYY-MM-DD.md
```

### 故障排除

**问题**：提示"当前笔记缺少元数据"
- **解决**：确保在周日志或月日志中运行此脚本，且笔记包含 `journal` 和 `journal-date` 元数据

**问题**：归档内容为空
- **解决**：检查对应日期范围内是否存在 daily 日志文件

**问题**：某些内容没有被过滤
- **解决**：这是预期行为，脚本只过滤预定义的内容类型，其他内容会保留

---
