---
created: 2026-01-23
area: Obsidian
type: readme
status: active
priority: 4
tags:
source:
keywords:
obsidianUIMode: preview
---

脚本文件：[[weekly-archive-task-stats.js]]

## 使用说明

### 功能简介
此脚本用于在**月度日志**和**年度日志**中，统计周日志归档中的任务完成数量。数据来源是周日志的归档section（## 🗄️周日志归档），而非直接的 daily 日志文件。

### 特点
- **自动识别日志类型**：根据当前文件路径自动判断是月度日志还是年度日志
- **灵活的统计模式**：
  - 月度日志：按日期统计每日任务完成量
  - 年度日志：按月份统计每月任务完成总量
- **丰富的可视化**：自动生成柱状图，区分工作日和周末（月度日志）
- **详细的统计概览**：提供总任务数、平均值、最高/最低值等统计信息

### 前置条件

使用此脚本前需要满足以下条件：

1. **周日志已归档**
   - 需要使用 `JournalArchive.js` 脚本生成周日志归档
   - 归档内容需要包含日期标题（格式：`### 周一 2025-06-02`）

2. **归档内容格式**
   - 每个日期section下需要包含已完成任务
   - 已完成任务格式：`- [x] 任务描述`

3. **文件路径**
   - 周日志：`500 Journal/530 Weekly/`
   - 月度日志：`500 Journal/520 Monthly/`
   - 年度日志：`500 Journal/510 Annual/`

### 使用方法

#### 在月度日志中使用

1. 打开或创建月度日志（如：`2025-07.md`）
2. 在需要显示统计的位置添加以下代码：

````markdown
```dataviewjs
dv.view("weekly-archive-task-stats")
```
````

3. 确保月度日志包含正确的元数据：

```yaml
---
journal: Monthly
journal-date: 2025-07-01
year: 2025
month: 7
---
```

#### 在年度日志中使用

1. 打开或创建年度日志（如：`2025.md`）
2. 在需要显示统计的位置添加以下代码：

````markdown
```dataviewjs
dv.view("weekly-archive-task-stats")
```
````

3. 确保年度日志包含正确的元数据：

```yaml
---
journal: Annual
journal-date: 2025-01-01
year: 2025
---
```

### 输出示例

#### 月度日志输出

##### 统计表格

| 日期 | 星期 | 完成任务数 |
|------|------|-----------|
| 2025-06-02 | 周一 | 3 |
| 2025-06-03 | 周二 | 5 |
| 2025-06-04 | 周三 | 2 |

##### 统计概览

```
**📈 2025-06 月份统计概览：**
- 📅 统计天数：21 天
- ✅ 总完成任务数：87
- 📊 平均每日完成：4.1 个
- 🔺 单日最高：8 个
- 🔻 单日最低：1 个
```

##### 柱状图
工作日和周末分别以不同颜色显示

#### 年度日志输出

##### 统计表格

| 月份 | 完成任务总数 |
|------|-------------|
| 01 | 120 |
| 02 | 95 |
| 03 | 140 |

##### 统计概览

```
**📈 2025 年度统计概览：**
- 📅 有效月份数：12 个月
- ✅ 总完成任务数：1456
- 📊 平均每月完成：121.3 个
- 🔺 最高月份：08月（158 个）
- 🔻 最低月份：02月（95 个）
```

### 自定义配置

脚本支持通过 `input` 参数覆盖默认配置：

```javascript
dv.view("weekly-archive-task-stats", {
  weeklyFolder: '500 Journal/530 Weekly',      // 周日志文件夹路径
  monthlyFolder: '500 Journal/520 Monthly',    // 月度日志文件夹路径
  annualFolder: '500 Journal/510 Annual',       // 年度日志文件夹路径
  archiveSectionPattern: /##\s*🗄️.*?归档/i,    // 归档section标题匹配
  dateHeaderPattern: /###\s*.*?(\d{4}-\d{2}-\d{2})/,  // 日期标题匹配
  completedTaskPattern: /^\s*-\s*\[x\]/m      // 已完成任务匹配
})
```

### 工作原理

1. **数据提取**
   - 扫描 `500 Journal/530 Weekly` 文件夹下的所有周日志
   - 查找每个周日志中的归档section（## 🗄️周日志归档）
   - 解析归档section中的日期标题（### 周一 2025-06-02）

2. **任务统计**
   - 统计每个日期section下的 `- [x]` 格式任务数量
   - 记录日期和对应的完成任务数

3. **数据汇总**
   - 月度日志：筛选目标月份的所有日期数据
   - 年度日志：按月份汇总任务总数

4. **可视化展示**
   - 生成统计表格
   - 计算统计概览（总数、平均值、最高/最低）
   - 生成柱状图

### 使用场景

- 📊 **月度回顾**：快速查看当月每日任务完成情况
- 📈 **年度总结**：了解全年各月份的任务完成趋势
- 🎯 **目标追踪**：通过任务完成数据追踪月度/年度目标进度
- 📝 **数据归档**：将周日志归档中的任务数据可视化，便于长期回顾

### 与现有脚本的区别

| 脚本 | 数据来源 | 统计维度 | 使用场景 |
|------|---------|---------|---------|
| `weekly-archive-task-stats.js` | 周日志归档section | 日期/月份 | 月度/年度日志中的任务统计 |
| 月度日志中的Dataview查询 | Daily日志文件 | 日期 | 统计Daily日志中的任务 |
| 年度日志中的Dataview查询 | Daily日志文件 | 月份 | 统计Daily日志中的任务 |

**关键差异**：
- 本脚本读取的是**周日志归档**中的数据
- Dataview查询读取的是**Daily日志文件**中的数据
- 两者数据来源不同，结果可能不一致

### 故障排除

#### 问题1：提示"请在月度日志或年度日志中使用此脚本"
**原因**：当前文件不在月度或年度日志文件夹中
**解决**：
- 确保文件路径包含 `500 Journal/520 Monthly`（月度日志）
- 或包含 `500 Journal/510 Annual`（年度日志）

#### 问题2：显示"没有找到周日志归档记录"
**原因**：
1. 周日志尚未生成归档
2. 归档section标题格式不正确
3. 目标月份/年份没有对应的周日志

**解决**：
1. 运行 `JournalArchive.js` 脚本生成周日志归档
2. 检查归档section标题格式是否为 `## 🗄️周日志归档`
3. 确认目标月份/年份存在对应的周日志文件

#### 问题3：统计结果为0或不完整
**原因**：
1. 归档内容中的日期标题格式不正确
2. 日期下没有已完成任务（`- [x]` 格式）
3. 任务格式不符合要求

**解决**：
1. 检查日期标题格式是否为 `### 周一 2025-06-02`
2. 确认任务使用 `- [x]` 格式标记为已完成
3. 检查任务是否在正确的日期section下

#### 问题4：图表不显示
**原因**：
1. Dataview插件版本过低
2. 未安装或未启用Dataview Chart插件

**解决**：
1. 更新Dataview插件到最新版本
2. 安装并启用Dataview Chart插件（Dataview的高级图表功能）

### 技术说明

#### 依赖项
- **Dataview插件**：用于运行DataviewJS代码
- **Obsidian API**：用于读取文件内容

#### 性能考虑
- 脚本会扫描所有周日志文件，如果周日志数量很多，可能会有轻微延迟
- 建议定期清理旧的周日志，以保持良好的性能

#### 数据一致性
- 脚本依赖 `JournalArchive.js` 生成的归档内容
- 如果归档内容被手动修改，可能影响统计结果
- 建议使用统一的归档脚本，保持数据格式一致性

### 进阶使用

#### 结合其他统计脚本
可以将此脚本与其他统计脚本结合使用，实现多维度的任务统计：

````markdown
```dataviewjs
// 周日志归档统计
dv.view("weekly-archive-task-stats")
```

```dataview
// Daily日志任务统计
TABLE length(filter(file.tasks, (t) => t.completed = true)) as 完成任务数
FROM "500 Journal/540 Daily"
WHERE journal-date AND dateformat(journal-date, "yyyy-MM") = "2025-07"
SORT file.day ASC
```
````

这样可以对比不同数据来源的统计结果。

#### 自定义样式
如果需要自定义表格或图表的样式，可以在CSS中添加相应的样式规则。

---

**版本历史：**
- v1.0.0 (2026-01-23) - 初始版本，支持月度和年度日志的任务统计
