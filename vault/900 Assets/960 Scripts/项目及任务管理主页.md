---
cssclasses:
  - fullwidth
  - matrix
start_date: 2025-01-01
due_date: 2025-12-31
---

| `button-projectFolder` | `button-mainProject` |
| ---------------------- | -------------------- |

```dataviewjs
// === é…ç½®åŒºåŸŸ ===
const maxNotesDisplay = 5;  // æ¯ä¸ªé¡¹ç›®æœ€å¤šæ˜¾ç¤ºå‡ ä¸ªç¬”è®° (0 = æ˜¾ç¤ºå…¨éƒ¨)

// === è·å–å½“å‰é¡µé¢çš„æ—¶é—´ç­›é€‰èŒƒå›´ ===
const currentPage = dv.current();
const filterStart = currentPage.start_date;  // ä»å½“å‰é¡µé¢çš„ start_date è¯»å–
const filterEnd = currentPage.due_date;      // ä»å½“å‰é¡µé¢çš„ due_date è¯»å–

// === è·å–æ‰€æœ‰ Projects ä¸‹çš„ç¬”è®° ===
const allNotes = dv.pages('"100 Projects"')
    .where(p => p.file.folder !== "100 Projects"); // æ’é™¤æ ¹ç›®å½•æ–‡ä»¶

// === æŒ‰æ–‡ä»¶å¤¹åˆ†ç»„ ===
const projectGroups = allNotes.groupBy(p => p.file.folder);

// === åˆ›å»ºå¡ç‰‡å®¹å™¨ ===
const container = dv.container.createEl("div", { cls: "projects-container" });

// ç»Ÿè®¡æ˜¾ç¤ºçš„é¡¹ç›®æ•°
let displayedProjects = 0;

// === éå†æ¯ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹ ===
for (let group of projectGroups) {
    const folderPath = group.key;
    const folderName = folderPath.split("/").pop();
    const notes = group.rows;

    // === æ‰¾é¡¹ç›®æ–‡ä»¶ï¼ˆtype: projectï¼‰ ===
    const projectFile = notes.find(n => n.type === "project");

    // === æå–é¡¹ç›®ä¿¡æ¯ ===
    let projectName, startDate, endDate, status, priority, progress;

    if (projectFile) {
        // æœ‰é¡¹ç›®æ–‡ä»¶ï¼Œä½¿ç”¨å…ƒæ•°æ®å’Œé¡¹ç›®æ–‡ä»¶å
        projectName = projectFile.file.name;  // ä½¿ç”¨é¡¹ç›®æ–‡ä»¶çš„æ–‡ä»¶å
        startDate = projectFile.start_date || "";
        endDate = projectFile.due_date || projectFile.end_date || "";
        status = projectFile.status || "";
        priority = projectFile.priority || "";
        progress = projectFile.progress || "";
    } else {
        // æ²¡æœ‰é¡¹ç›®æ–‡ä»¶ï¼Œè§£ææ–‡ä»¶å¤¹å
        projectName = folderName;
        const dateMatch = folderName.match(/^(\d{6})/);
        startDate = dateMatch ? `${dateMatch[1].substring(0,4)}-${dateMatch[1].substring(4,6)}-01` : "";
        endDate = "";
        status = "";
        priority = "";
        progress = "";
    }

    // === æ—¶é—´ç­›é€‰é€»è¾‘ ===
    // é¡¹ç›®çš„å¼€å§‹æ—¶é—´æˆ–ç»“æŸæ—¶é—´åœ¨ç­›é€‰èŒƒå›´å†…ï¼Œå°±æ˜¾ç¤ºè¯¥é¡¹ç›®
    let shouldDisplay = false;

    if (startDate && endDate) {
        // å¦‚æœæœ‰å¼€å§‹å’Œç»“æŸæ—¥æœŸï¼Œæ£€æŸ¥æ˜¯å¦ä¸ç­›é€‰èŒƒå›´æœ‰äº¤é›†
        shouldDisplay = (startDate <= filterEnd && endDate >= filterStart);
    } else if (startDate) {
        // åªæœ‰å¼€å§‹æ—¥æœŸï¼Œæ£€æŸ¥å¼€å§‹æ—¥æœŸæ˜¯å¦åœ¨èŒƒå›´å†…
        shouldDisplay = (startDate >= filterStart && startDate <= filterEnd);
    } else if (endDate) {
        // åªæœ‰ç»“æŸæ—¥æœŸï¼Œæ£€æŸ¥ç»“æŸæ—¥æœŸæ˜¯å¦åœ¨èŒƒå›´å†…
        shouldDisplay = (endDate >= filterStart && endDate <= filterEnd);
    } else {
        // æ²¡æœ‰æ—¥æœŸä¿¡æ¯ï¼Œé»˜è®¤æ˜¾ç¤º
        shouldDisplay = true;
    }

    if (shouldDisplay) {
        displayedProjects++;

        // === åˆ›å»ºé¡¹ç›®å¡ç‰‡ ===
        const card = container.createEl("div", { cls: "project-card" });

        // é¡¹ç›®æ ‡é¢˜
        const titleWrapper = card.createEl("div", {
            attr: { style: "display: flex; justify-content: space-between; align-items: start;" }
        });

        const title = titleWrapper.createEl("h3", {
            attr: { style: "margin: 0; flex: 1;" }
        });
        title.textContent = projectName;

        // å³ä¾§ä¿¡æ¯å®¹å™¨ï¼ˆçŠ¶æ€å’Œä¼˜å…ˆçº§ï¼‰
        const badgesWrapper = titleWrapper.createEl("div", {
            attr: { style: "display: flex; gap: 5px; margin-top: 5px;" }
        });

        // å¦‚æœæœ‰ä¼˜å…ˆçº§ï¼Œæ·»åŠ ä¼˜å…ˆçº§æ ‡ç­¾
        if (priority) {
            const priorityBadge = badgesWrapper.createEl("span", {
                cls: "project-status",
                attr: { style: "margin: 0;" }
            });
            const priorityMap = {
                "1": "ğŸ”´", "2": "ğŸŸ ", "3": "ğŸŸ¡", "4": "ğŸ”µ", "5": "âšª",
                "æœ€é«˜": "ğŸ”´", "é«˜": "ğŸŸ ", "ä¸­": "ğŸŸ¡", "ä½": "ğŸ”µ", "æœ€ä½": "âšª"
            };
            priorityBadge.textContent = priorityMap[priority] || priority;
        }

        // å¦‚æœæœ‰çŠ¶æ€ï¼Œæ·»åŠ çŠ¶æ€æ ‡ç­¾
        if (status) {
            const statusBadge = badgesWrapper.createEl("span", {
                cls: "project-status",
                attr: { style: "margin: 0;" }
            });
            const statusMap = {
                "inbox": "ğŸ“¥", "draft": "âœï¸", "active": "ğŸš€",
                "on-hold": "â¸ï¸", "completed": "âœ…", "cancelled": "âŒ", "archived": "ğŸ“¦",
                "æœªå¼€å§‹/å¾…å¯åŠ¨": "ğŸ“¥", "èµ·è‰/æ„æ€ä¸­": "âœï¸", "æ‰§è¡Œä¸­": "ğŸš€",
                "æš‚åœ": "â¸ï¸", "å®Œæˆ": "âœ…", "å–æ¶ˆ": "âŒ", "å½’æ¡£": "ğŸ“¦"
            };
            statusBadge.textContent = statusMap[status] || status;

            // æ ¹æ®çŠ¶æ€æ·»åŠ ä¸åŒçš„ class
            if (status === "active" || status === "æ‰§è¡Œä¸­") {
                statusBadge.classList.add("active");
            } else if (status === "completed" || status === "å®Œæˆ") {
                statusBadge.classList.add("completed");
            } else if (status === "inbox" || status === "draft" || status === "æœªå¼€å§‹/å¾…å¯åŠ¨" || status === "èµ·è‰/æ„æ€ä¸­") {
                statusBadge.classList.add("planned");
            }
        }

        // å¦‚æœæœ‰è¿›åº¦ï¼Œæ·»åŠ è¿›åº¦æ¡
        if (progress) {
            const progressBar = card.createEl("div", {
                attr: {
                    style: "width: 100%; height: 8px; background: var(--background-modifier-border); border-radius: 4px; margin: 10px 0; overflow: hidden;"
                }
            });
            const progressFill = progressBar.createEl("div", {
                attr: {
                    style: `width: ${progress}%; height: 100%; background: var(--interactive-accent); transition: width 0.3s ease;`
                }
            });
        }

        // ç¬”è®°åˆ—è¡¨åŒºåŸŸ
        const notesDiv = card.createEl("div", { cls: "project-notes" });

        // è¿‡æ»¤å‡ºçœŸæ­£çš„ç¬”è®°ï¼ˆæ’é™¤é¡¹ç›®æ–‡ä»¶ï¼‰
        const notesList = notes.filter(n => n.type !== "project");

        if (notesList.length > 0) {
            const ul = notesDiv.createEl("ul");

            // æ ¹æ®é…ç½®æ˜¾ç¤ºç¬”è®°
            const notesToShow = maxNotesDisplay === 0 ? notesList : notesList.slice(0, maxNotesDisplay);

            notesToShow.forEach(note => {
                const li = ul.createEl("li");
                const link = li.createEl("a", {
                    cls: "internal-link",
                    href: note.file.path
                });
                link.textContent = note.file.name;
            });

            // å¦‚æœç¬”è®°æ•°è¶…è¿‡æ˜¾ç¤ºé™åˆ¶ï¼Œæ·»åŠ æç¤º
            if (maxNotesDisplay > 0 && notesList.length > maxNotesDisplay) {
                const moreText = notesDiv.createEl("div", {
                    cls: "notes-empty"
                });
                moreText.textContent = `è¿˜æœ‰ ${notesList.length - maxNotesDisplay} ä¸ªç¬”è®°...`;
            }
        } else {
            const emptyText = notesDiv.createEl("div", { cls: "notes-empty" });
            emptyText.textContent = "æš‚æ— ç¬”è®°";
        }

        // é¡¹ç›®å…ƒæ•°æ®ä¿¡æ¯
        const meta = card.createEl("div", { cls: "project-meta" });

        // æ—¥æœŸä¿¡æ¯
        const dateDiv = meta.createEl("div", { cls: "project-date" });
        const startDateFormatted = startDate ? dv.date(startDate).toFormat("yyyy-MM-dd") : "";
        const endDateFormatted = endDate ? dv.date(endDate).toFormat("yyyy-MM-dd") : "";
        const dateText = endDateFormatted
            ? `ğŸ“… ${startDateFormatted} ~ ${endDateFormatted}`
            : startDateFormatted
                ? `ğŸ“… ${startDateFormatted}`
                : "ğŸ“… æ—¥æœŸæœªè®¾ç½®";
        dateDiv.textContent = dateText;

        // ç¬”è®°æ•°é‡
        const countDiv = meta.createEl("div", { cls: "project-count" });
        countDiv.textContent = `ğŸ“ ${notesList.length} ä¸ªç¬”è®°`;
    }
}

// === å¦‚æœæ²¡æœ‰æ‰¾åˆ°ä»»ä½•é¡¹ç›® ===
if (displayedProjects === 0) {
    const empty = container.createEl("div", { cls: "project-empty" });
    empty.textContent = "ğŸ“­ å½“å‰æ—¶é—´æ®µå†…æ²¡æœ‰é¡¹ç›®";
}

// === åœ¨å¡ç‰‡å‰æ˜¾ç¤ºç­›é€‰ä¿¡æ¯ ===
const filterStartFormatted = dv.date(filterStart).toFormat("yyyy-MM-dd");
const filterEndFormatted = dv.date(filterEnd).toFormat("yyyy-MM-dd");
const filterInfo = dv.el("p", `ğŸ“Š æ˜¾ç¤º ${displayedProjects} ä¸ªé¡¹ç›® (${filterStartFormatted} ~ ${filterEndFormatted})`, {
    attr: { style: "color: var(--text-muted); margin-bottom: 10px;" }
});
```



```dataviewjs
// === è·å–å½“å‰é¡µé¢çš„æ—¶é—´ç­›é€‰èŒƒå›´ ===
const currentPage = dv.current();
const filterStart = currentPage.start_date;
const filterEnd = currentPage.due_date;

// è·å–æ‰€æœ‰é¡¹ç›®æ–‡ä»¶ï¼ˆtype: projectï¼‰
const pages = dv.pages('#project')
    .where(p => p.type === "project")
    .where(p => p.start_date && p.due_date)
    .where(p => {
        // æ£€æŸ¥é¡¹ç›®æ—¥æœŸèŒƒå›´æ˜¯å¦ä¸ç­›é€‰èŒƒå›´æœ‰äº¤é›†
        const projectStart = dv.date(p.start_date);
        const projectEnd = dv.date(p.due_date);
        const filterStartDate = dv.date(filterStart);
        const filterEndDate = dv.date(filterEnd);
        // æœ‰äº¤é›†ï¼šé¡¹ç›®å¼€å§‹ <= ç­›é€‰ç»“æŸ && é¡¹ç›®ç»“æŸ >= ç­›é€‰å¼€å§‹
        return projectStart <= filterEndDate && projectEnd >= filterStartDate;
    })
    .where(p => p.status !== "cancelled")
    .sort(p => p.due_date, 'asc');

// ç”Ÿæˆ Mermaid ç”˜ç‰¹å›¾ä»£ç 
let mermaidCode = "```mermaid\ngantt\n";
mermaidCode += "    title é¡¹ç›®è¿›åº¦\n";
mermaidCode += "    dateFormat YYYY-MM-DD\n";
mermaidCode += "    axisFormat %y-%m\n\n";

// æŒ‰ objective åˆ†ç»„ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
const groupedPages = {};
pages.forEach(page => {
    const objective = page.objective || "é»˜è®¤é¡¹ç›®";
    if (!groupedPages[objective]) {
        groupedPages[objective] = [];
    }
    groupedPages[objective].push(page);
});

// ç”Ÿæˆç”˜ç‰¹å›¾é¡¹ç›®æ¡ç›®
Object.keys(groupedPages).forEach(context => {
    if (Object.keys(groupedPages).length > 1) {
        mermaidCode += `    section ${context}\n`;
    }

    groupedPages[context].forEach(page => {
        const taskName = page.file.name.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, ''); // æ¸…ç†ä»»åŠ¡åç§°
        const startDate = dv.date(page.start_date).toFormat("yyyy-MM-dd");
        const dueDate = dv.date(page.due_date).toFormat("yyyy-MM-dd");

        // çŠ¶æ€æ˜ å°„
        let status = "";
        if (page.status === "completed") {
            status = "done, ";
        } else if (page.status === "active") {
            status = "active, ";
        }

        mermaidCode += `    ${page.file.name} :${status}${taskName}, ${startDate}, ${dueDate}\n`;
    });

    mermaidCode += "\n";
});

mermaidCode += "```";

// æ˜¾ç¤ºç”Ÿæˆçš„ Mermaid ä»£ç 
dv.paragraph(mermaidCode);
```

